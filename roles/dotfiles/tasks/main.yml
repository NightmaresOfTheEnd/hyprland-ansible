---
# Additional configuration files deployment

- name: Deploy wofi configuration
  copy:
    dest: "{{ user_home }}/.config/wofi/config"
    content: |
      width=600
      height=400
      location=center
      show=drun
      prompt=Search...
      filter_rate=100
      allow_markup=true
      no_actions=true
      halign=fill
      orientation=vertical
      content_halign=fill
      insensitive=true
      allow_images=true
      image_size=32
      gtk_dark=true
      dynamic_lines=true
    mode: '0644'
    force: false

- name: Deploy wofi style
  copy:
    dest: "{{ user_home }}/.config/wofi/style.css"
    content: |
      window {
          margin: 0px;
          border: 2px solid #88c0d0;
          border-radius: 15px;
          background-color: #2e3440;
          font-family: "JetBrainsMono Nerd Font";
          font-size: 14px;
      }

      #input {
          margin: 5px;
          padding: 10px;
          border: none;
          border-radius: 10px;
          color: #eceff4;
          background-color: #3b4252;
      }

      #inner-box {
          margin: 5px;
          border: none;
          background-color: transparent;
      }

      #outer-box {
          margin: 5px;
          border: none;
          background-color: transparent;
      }

      #scroll {
          margin: 5px;
          border: none;
      }

      #text {
          margin: 5px;
          color: #eceff4;
      }

      #entry:selected {
          background-color: #4c566a;
          border-radius: 10px;
      }

      #entry:selected #text {
          color: #88c0d0;
      }
    mode: '0644'
    force: false

- name: Deploy mako notification config
  copy:
    dest: "{{ user_home }}/.config/mako/config"
    content: |
      sort=-time
      layer=overlay
      background-color=#2e3440
      width=350
      height=150
      border-size=2
      border-color=#88c0d0
      border-radius=12
      icons=1
      max-icon-size=64
      default-timeout=5000
      ignore-timeout=1
      font=JetBrainsMono Nerd Font 11
      margin=10

      [urgency=low]
      border-color=#4c566a

      [urgency=normal]
      border-color=#88c0d0

      [urgency=high]
      border-color=#bf616a
      default-timeout=0
    mode: '0644'
    force: false

- name: Deploy waybar config
  copy:
    dest: "{{ user_home }}/.config/waybar/config"
    content: |
      {
          "reload_style_on_change": true,
          "layer": "top",
          "position": "top",
          "spacing": 0,
          "height": 26,

          "hyprland/workspaces": {
              "on-scroll-up": "hyprctl dispatch workspace r-1",
              "on-scroll-down": "hyprctl dispatch workspace r+1",
              "on-click": "activate",
              "format": "{icon}",
              "format-icons": {
                  "default": "",
                  "1": "1",
                  "2": "2",
                  "3": "3",
                  "4": "4",
                  "5": "5",
                  "6": "6",
                  "7": "7",
                  "8": "8",
                  "9": "9",
                  "active": "󱓻"
              },
              "persistent-workspaces": {
                  "*": 5
              }
          },

          "modules-left": [
              "hyprland/workspaces",
              "custom/filemanager"
          ],

          "modules-center": [
              "clock"
          ],

          "modules-right": [
              "pulseaudio",
              "bluetooth",
              "network",
              "cpu",
              "battery",
              "tray"
          ],

          "clock": {
              "format": "{:%A %H:%M}",
              "format-alt": "{:%d %B %Y}",
              "tooltip": false
          },

          "cpu": {
              "interval": 5,
              "format": "",
              "on-click": "ghostty -e btop"
          },

          "pulseaudio": {
              "scroll-step": 1,
              "format": "{icon}",
              "on-click": "pavucontrol",
              "on-click-right": "pamixer -t",
              "tooltip-format": "Volume: {volume}%",
              "format-muted": "",
              "format-icons": {
                  "default": ["", "", " "]
              }
          },

          "network": {
              "format-icons": ["󰤯", "󰤟", "󰤢", "󰤥", "󰤨"],
              "format": "{icon}",
              "format-wifi": "{icon}",
              "format-ethernet": "󰀂",
              "format-disconnected": "󰤮",
              "tooltip-format-wifi": "{essid} ({signalStrength}%)",
              "tooltip-format-ethernet": "{ifname}: {ipaddr}",
              "tooltip-format-disconnected": "Disconnected",
              "on-click": "nm-connection-editor"
          },

          "battery": {
              "format": "{capacity}% {icon}",
              "format-discharging": "{icon}",
              "format-charging": "{icon}",
              "format-plugged": "",
              "format-icons": {
                  "charging": ["󰢜", "󰂆", "󰂇", "󰂈", "󰢝", "󰂉", "󰢞", "󰂊", "󰂋", "󰂅"],
                  "default": ["󰁺", "󰁻", "󰁼", "󰁽", "󰁾", "󰁿", "󰂀", "󰂁", "󰂂", "󰁹"]
              },
              "format-full": "󰂅",
              "tooltip-format-discharging": "{capacity}% ({time})",
              "tooltip-format-charging": "{capacity}% ({time})",
              "states": {
                  "warning": 20,
                  "critical": 10
              }
          },

          "bluetooth": {
              "format": "",
              "format-disabled": "󰂲",
              "format-connected": "",
              "tooltip-format": "Devices connected: {num_connections}",
              "on-click": "bluetui"
          },

          "custom/filemanager": {
              "format": "",
              "on-click": "thunar",
              "tooltip-format": "Open File Manager"
          },

          "tray": {
              "spacing": 10
          }
      }
    mode: '0644'
    force: false

- name: Deploy waybar style with dynamic theme import
  copy:
    dest: "{{ user_home }}/.config/waybar/style.css"
    content: |
      /* Import colors from current theme */
      @import "../../.local/share/dotfiles/current/theme/waybar.css";

      * {
          background-color: transparent;
          color: @foreground;
          border: none;
          border-radius: 0;
          min-height: 0;
          font-family: JetBrainsMono Nerd Font;
          font-size: 14px;
      }

      window#waybar {
          background-color: alpha(@background, 0.9);
      }

      .modules-left {
          margin: 8px 0px 8px 10px;
      }

      .modules-right {
          margin: 8px 10px 8px 0px;
      }

      #workspaces button {
          all: initial;
          padding: 0 6px;
          margin: 0 1.5px;
          min-width: 9px;
          color: @foreground;
      }

      #workspaces button.empty {
          opacity: 0.5;
      }

      #workspaces button.active {
          color: @foreground;
          font-weight: bold;
      }

      #cpu,
      #bluetooth,
      #pulseaudio,
      #network,
      #clock,
      #battery,
      #custom-filemanager,
      #tray {
          min-width: 12px;
          margin: 0 8px;
          font-size: 14px;
      }

      #battery.warning {
          color: #ebcb8b;
      }

      #battery.critical {
          color: #bf616a;
      }

      tooltip {
          background-color: alpha(@background, 0.9);
          padding: 20px;
          margin: 0px;
      }

      tooltip label {
          color: @foreground;
      }
    mode: '0644'
    force: false

- name: Deploy hypridle config
  copy:
    dest: "{{ user_home }}/.config/hypr/hypridle.conf"
    content: |
      general {
          lock_cmd = pidof hyprlock || hyprlock
          before_sleep_cmd = loginctl lock-session
          after_sleep_cmd = hyprctl dispatch dpms on
      }

      listener {
          timeout = 300
          on-timeout = brightnessctl -s set 30%
          on-resume = brightnessctl -r
      }

      listener {
          timeout = 600
          on-timeout = loginctl lock-session
      }

      listener {
          timeout = 660
          on-timeout = hyprctl dispatch dpms off
          on-resume = hyprctl dispatch dpms on
      }

      listener {
          timeout = 1800
          on-timeout = systemctl suspend
      }
    mode: '0644'
    force: false

- name: Deploy hyprlock config
  copy:
    dest: "{{ user_home }}/.config/hypr/hyprlock.conf"
    content: |
      general {
          disable_loading_bar = false
          hide_cursor = true
          grace = 0
          no_fade_in = false
      }

      background {
          monitor =
          path = screenshot
          blur_passes = 3
          blur_size = 8
          noise = 0.0117
          contrast = 0.8916
          brightness = 0.8172
          vibrancy = 0.1696
          vibrancy_darkness = 0.0
      }

      input-field {
          monitor =
          size = 300, 50
          outline_thickness = 2
          dots_size = 0.2
          dots_spacing = 0.64
          dots_center = true
          outer_color = rgb(136, 192, 208)
          inner_color = rgb(46, 52, 64)
          font_color = rgb(236, 239, 244)
          fade_on_empty = true
          placeholder_text = <i>Password...</i>
          hide_input = false
          position = 0, -20
          halign = center
          valign = center
      }

      label {
          monitor =
          text = $TIME
          font_size = 64
          font_family = JetBrainsMono Nerd Font
          color = rgb(236, 239, 244)
          position = 0, 150
          halign = center
          valign = center
      }

      label {
          monitor =
          text = Hi, $USER
          font_size = 20
          font_family = JetBrainsMono Nerd Font
          color = rgb(136, 192, 208)
          position = 0, 80
          halign = center
          valign = center
      }
    mode: '0644'
    force: false

- name: Deploy hyprpaper config
  copy:
    dest: "{{ user_home }}/.config/hypr/hyprpaper.conf"
    content: |
      # Hyprpaper configuration
      # Uses dynamic wallpaper from current theme

      preload = ~/.local/share/dotfiles/current/background

      # Apply wallpaper to all monitors
      wallpaper = ,~/.local/share/dotfiles/current/background

      # Disable splash
      splash = false
    mode: '0644'
    force: false

- name: Deploy ghostty config
  copy:
    dest: "{{ user_home }}/.config/ghostty/config"
    content: |
      # Ghostty terminal configuration

      font-family = JetBrainsMono Nerd Font
      font-size = 12

      window-padding-x = 10
      window-padding-y = 10

      copy-on-select = clipboard
      confirm-close-surface = false

      gtk-titlebar = false

      # Import theme from current theme
      config-file = ~/.local/share/dotfiles/current/theme/ghostty.conf
    mode: '0644'
    force: false

- name: Deploy btop config
  copy:
    dest: "{{ user_home }}/.config/btop/btop.conf"
    content: |
      color_theme = "current"
      theme_background = False
      truecolor = True
      vim_keys = True
      rounded_corners = True
      graph_symbol = "braille"
      shown_boxes = "cpu mem net proc"
      update_ms = 1000
      proc_sorting = "cpu lazy"
      proc_tree = False
      proc_per_core = True
      proc_mem_bytes = True
    mode: '0644'
    force: false

- name: Download default wallpaper
  get_url:
    url: https://raw.githubusercontent.com/NordTheme/wallpapers/main/nord-2560x1440.png
    dest: "{{ user_home }}/Pictures/wallpapers/default.png"
    mode: '0644'
  failed_when: false

- name: Create GTK settings
  copy:
    dest: "{{ user_home }}/.config/gtk-3.0/settings.ini"
    content: |
      [Settings]
      gtk-theme-name=Adwaita-dark
      gtk-icon-theme-name=Yaru
      gtk-font-name=Noto Sans 11
      gtk-cursor-theme-name=Bibata-Modern-Ice
      gtk-cursor-theme-size=24
      gtk-application-prefer-dark-theme=true
    mode: '0644'
    force: false

- name: Create GTK 4.0 settings
  copy:
    dest: "{{ user_home }}/.config/gtk-4.0/settings.ini"
    content: |
      [Settings]
      gtk-theme-name=Adwaita-dark
      gtk-icon-theme-name=Yaru
      gtk-font-name=Noto Sans 11
      gtk-cursor-theme-name=Bibata-Modern-Ice
      gtk-cursor-theme-size=24
      gtk-application-prefer-dark-theme=true
    mode: '0644'
    force: false
